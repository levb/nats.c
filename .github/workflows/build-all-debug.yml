name: build all (Debug)

on:
  workflow_call:

defaults:
  run:
    shell: bash --noprofile --norc -x -eo pipefail {0}

jobs:
  debug-coverage:
    strategy:
      matrix:
        include:
          - compiler: gcc
            coverage: ON
          - compiler: clang
            coverage: OFF
    uses: ./.github/workflows/build-test.yml
    with:
      compiler: ${{ matrix.compiler }}
      coverage: ${{ matrix.coverage }}
      type: Debug
      name: "${{ matrix.compiler }}: coverage ${{ matrix.coverage }}"
  
  sanitize-address:
    strategy:
      matrix:
        lib_msg_delivery: [ON, OFF]
        lib_write_deadline: [ON, OFF]
        exclude:
          - lib_msg_delivery: ON
            lib_write_deadline: ON
    uses: ./.github/workflows/build-test.yml
    with:
      sanitize: address
      lib_msg_delivery: ${{ matrix.lib_msg_delivery }}
      lib_write_deadline: ${{ matrix.lib_write_deadline }}
      name: "gcc: sanitize address: ${{ (matrix.lib_msg_delivery == 'ON' && matrix.lib_write_deadline == 'OFF' && 'msg-delivery') || (matrix.lib_msg_delivery == 'OFF' && matrix.lib_write_deadline == 'ON' && 'write-deadline') || 'default' }}"
  
  sanitize-thread:
    uses: ./.github/workflows/build-test.yml
    with:
      sanitize: thread
      name: "gcc: sanitize thread"
